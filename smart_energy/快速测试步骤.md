# 快速测试步骤

## 第一步：启动应用

```bash
mvn clean compile
mvn spring-boot:run
```

等待看到：`Started PlantSystemApplication in X.XXX seconds`

## 第二步：测试数据库连接

在浏览器中访问：

```
http://localhost:2008/SmartEnergy/test/db
```

**预期结果：**
```json
{
  "success": true,
  "message": "数据库连接成功！",
  "databaseUrl": "jdbc:mysql://121.196.200.165:3306/smart_energy...",
  "userQuery": "成功",
  "testUser": {
    "userId": "001",
    "name": "用户1",
    "role": "能源管理员",
    "hasPassword": true
  }
}
```

**如果失败：**
- 检查数据库服务是否运行
- 检查 `application.properties` 中的数据库配置
- 检查网络连接

## 第三步：检查用户数据

访问：

```
http://localhost:2008/SmartEnergy/test/users
```

**预期结果：**
```json
{
  "success": true,
  "count": 20,
  "users": [
    {
      "userId": "001",
      "name": "用户1",
      "role": "能源管理员",
      "passwordLength": 64
    },
    ...
  ]
}
```

**如果用户不存在或密码长度为0：**
- 执行 `sql/05_测试数据_修正版.sql` 插入测试数据
- 或执行以下SQL：
```sql
INSERT INTO `用户表` (`用户ID`, `姓名`, `密码`, `角色`) 
VALUES ('001', '用户1', '8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92', '系统管理员');
```

## 第四步：测试密码加密

访问：

```
http://localhost:2008/SmartEnergy/test/password
```

**预期结果：**
```json
{
  "success": true,
  "originalPassword": "123456",
  "hashedPassword": "8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92",
  "matches": true,
  "dbPasswordMatches": true
}
```

**如果 `dbPasswordMatches` 为 `false`：**
- 执行以下SQL更新密码：
```sql
UPDATE `用户表` 
SET `密码` = '8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92' 
WHERE `用户ID` = '001';
```

## 第五步：测试登录

1. 访问登录页面：
   ```
   http://localhost:2008/SmartEnergy/login
   ```

2. 输入：
   - 用户ID：`001`
   - 密码：`123456`

3. 点击登录

**如果登录失败：**
- 打开浏览器开发者工具（F12）
- 查看 Console 标签的错误信息
- 查看 Network 标签中 `/auth/login` 请求的响应
- 查看服务器日志中的异常信息

## 常见问题快速解决

### 问题1：数据库连接失败

**检查：**
1. MySQL服务是否运行
2. 数据库地址是否正确：`121.196.200.165:3306`
3. 用户名密码是否正确：`jw / 1111`
4. 数据库 `smart_energy` 是否存在

**解决：**
```sql
-- 连接到数据库测试
mysql -h 121.196.200.165 -u jw -p1111 smart_energy

-- 如果连接成功，检查表是否存在
SHOW TABLES;
```

### 问题2：用户不存在

**解决：**
```sql
-- 检查用户表
SELECT * FROM `用户表` WHERE `用户ID` = '001';

-- 如果不存在，插入用户
INSERT INTO `用户表` (`用户ID`, `姓名`, `密码`, `角色`) 
VALUES ('001', '用户1', '8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92', '系统管理员');
```

### 问题3：密码不匹配

**解决：**
```sql
-- 更新所有用户的密码为 "123456" 的SHA-256哈希值
UPDATE `用户表` 
SET `密码` = '8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92';
```

### 问题4：登录返回HTML而不是JSON

**原因：** 拦截器拦截了登录请求

**解决：** 已修复，确保 `Config/SecurityConfig.java` 中包含：
```java
.excludePathPatterns(
    "/auth/**",
    "/SmartEnergy/auth/**",
    "/test/**",
    "/SmartEnergy/test/**",
    // ...
)
```

重启应用后重试。

## 调试信息

如果所有测试都通过但登录仍然失败，在 `Service/AuthService.java` 的 `login` 方法开头添加：

```java
System.out.println("=== 登录调试 ===");
System.out.println("用户ID: " + userId);
System.out.println("输入密码: " + password);
User user = userDao.getUserById(userId);
if (user != null) {
    System.out.println("找到用户: " + user.getName());
    System.out.println("数据库密码: " + user.getPassword());
    String hashed = SecurityTool.encryptPassword(password);
    System.out.println("加密后: " + hashed);
    System.out.println("匹配: " + hashed.equals(user.getPassword()));
} else {
    System.out.println("用户不存在！");
}
```

然后查看服务器控制台的输出。

