# SmartEnergy智慧能源管理系统 - 数据库结构设计文档

## 一、需求分析

### 1.1 业务需求概述

围绕工业企业"多能协同、降本增效"的能源管理目标，设计集配电网监测、分布式光伏管理、综合能耗管理、告警运维、大屏数据展示于一体的综合平台。

### 1.2 核心业务线

1. **配电网监测业务线**：配电房信息、回路监测数据、变压器监测数据
2. **分布式光伏管理业务线**：光伏设备信息、光伏发电数据、光伏预测数据
3. **综合能耗管理业务线**：能耗计量设备信息、能耗监测数据、峰谷能耗数据
4. **告警运维管理业务线**：告警信息、运维工单数据、设备台账数据
5. **大屏数据展示业务线**：大屏展示配置、实时汇总数据、历史趋势数据

## 二、数据字典

### 2.1 配电网监测业务线

#### 2.1.1 配电房信息表（配电房信息表）

| 属性名称 | 数据类型 | 长度 | 约束条件 | 说明 |
|---------|---------|------|---------|------|
| 配电房编号 | VARCHAR | 15 | PRIMARY KEY, NOT NULL, UNIQUE | 唯一标识配电房，如"PD-35kV-001" |
| 名称 | VARCHAR | 20 | NOT NULL | 配电房名称，如"总配电房"、"分配电房1" |
| 位置描述 | VARCHAR | 50 | NOT NULL | 具体地址+区域，如"XX园区A栋地下1层" |
| 电压等级 | VARCHAR | 10 | NOT NULL | 符合国标，如"35kV/0.4kV"、"10kV/0.4kV" |
| 变压器数量 | TINYINT | - | NOT NULL, CHECK(>=1) | 一般1-5台 |
| 投运时间 | DATE | - | NOT NULL | 格式：YYYY-MM-DD |
| 负责人ID | VARCHAR | 20 | NOT NULL | 关联人员管理系统ID |
| 联系方式 | VARCHAR | 20 | NOT NULL | 手机号（11位）或固定电话 |

#### 2.1.2 回路监测数据表（回路监测数据表）

| 属性名称 | 数据类型 | 长度 | 约束条件 | 说明 |
|---------|---------|------|---------|------|
| 数据编号 | VARCHAR | 20 | PRIMARY KEY, NOT NULL, UNIQUE | 按"回路编号+采集时间戳"编码 |
| 配电房编号 | VARCHAR | 15 | FOREIGN KEY, NOT NULL | 关联配电房信息表 |
| 回路编号 | VARCHAR | 10 | NOT NULL | 如"L1"、"L2" |
| 采集时间 | DATETIME | - | NOT NULL | 格式：YYYY-MM-DD HH:MM:SS |
| 电压（kV） | DECIMAL | 5,2 | NOT NULL | 35kV回路：34.5-36.7kV；0.4kV回路：0.38-0.42kV |
| 电流（A） | DECIMAL | 8,2 | NOT NULL | 0.4kV回路一般≤630A |
| 有功功率（kW） | DECIMAL | 10,2 | NOT NULL | 0.4kV回路：0-400kW |
| 无功功率（kVar） | DECIMAL | 10,2 | NOT NULL | 与有功功率匹配 |
| 功率因数 | DECIMAL | 4,2 | NOT NULL | 0.85-1.00 |
| 正向有功电量（kWh） | DECIMAL | 12,2 | NOT NULL | 累计值 |
| 反向有功电量（kWh） | DECIMAL | 12,2 | NOT NULL | 一般≤正向电量的5% |
| 开关状态 | VARCHAR | 5 | NOT NULL | "分闸"、"合闸" |
| 电缆头温度（℃） | DECIMAL | 5,1 | NOT NULL | 正常≤90℃，超100℃触发告警 |
| 电容器温度（℃） | DECIMAL | 5,1 | NOT NULL | 正常≤65℃，超75℃触发告警 |

#### 2.1.3 变压器监测数据表（变压器监测数据表）

| 属性名称 | 数据类型 | 长度 | 约束条件 | 说明 |
|---------|---------|------|---------|------|
| 数据编号 | VARCHAR | 20 | PRIMARY KEY, NOT NULL, UNIQUE | 按"变压器编号+采集时间戳"编码 |
| 配电房编号 | VARCHAR | 15 | FOREIGN KEY, NOT NULL | 关联配电房信息表 |
| 变压器编号 | VARCHAR | 10 | NOT NULL | 如"BYSQ-001" |
| 采集时间 | DATETIME | - | NOT NULL | 格式：YYYY-MM-DD HH:MM:SS |
| 负载率（%） | DECIMAL | 5,2 | NOT NULL | 正常≤80%，短期允许≤100% |
| 绕组温度（℃） | DECIMAL | 5,1 | NOT NULL | 油浸式变压器：正常≤85℃，超95℃触发告警 |
| 铁芯温度（℃） | DECIMAL | 5,1 | NOT NULL | 一般比绕组温度低5-10℃ |
| 环境温度（℃） | DECIMAL | 5,1 | NOT NULL | 配电房内一般-5℃~40℃ |
| 环境湿度（%） | DECIMAL | 5,1 | NOT NULL | 配电房内一般30%~70% |
| 运行状态 | VARCHAR | 5 | NOT NULL | "正常"、"异常" |

### 2.2 分布式光伏管理业务线

#### 2.2.1 光伏设备信息表（光伏设备信息表）

| 属性名称 | 数据类型 | 长度 | 约束条件 | 说明 |
|---------|---------|------|---------|------|
| 设备编号 | VARCHAR | 20 | PRIMARY KEY, NOT NULL, UNIQUE | 如"SD-PV-001" |
| 设备类型 | VARCHAR | 50 | NOT NULL | "逆变器"、"汇流箱" |
| 安装位置 | VARCHAR | 50 | NOT NULL | 屋顶区域编号/园区片区 |
| 装机容量 | VARCHAR | 50 | NOT NULL | 单位：kWp |
| 投运时间 | DATE | - | NOT NULL | 格式：YYYY-MM-DD |
| 校准周期 | INT | - | NOT NULL | 单位：月，≥3且≤24 |
| 运行状态 | VARCHAR | 10 | NOT NULL | "正常"、"故障"、"离线" |
| 通信协议 | VARCHAR | 20 | NOT NULL | "RS485"、"Lora"、"以太网" |

#### 2.2.2 光伏发电数据表（光伏发电数据表）

| 属性名称 | 数据类型 | 长度 | 约束条件 | 说明 |
|---------|---------|------|---------|------|
| 数据编号 | VARCHAR | 20 | PRIMARY KEY, NOT NULL, UNIQUE | 唯一标识单条发电数据 |
| 设备编号 | VARCHAR | 20 | FOREIGN KEY, NOT NULL | 关联光伏设备信息表 |
| 并网点编号 | VARCHAR | 20 | NOT NULL | 关联并网点 |
| 采集时间 | DATETIME | - | NOT NULL | 格式：YYYY-MM-DD HH:MM:SS |
| 发电量（kWh） | DECIMAL | 12,2 | NOT NULL | ≥0 |
| 上网电量（kWh） | DECIMAL | 12,2 | NOT NULL | ≥0 |
| 自用电量（kWh） | DECIMAL | 12,2 | NOT NULL | ≥0 |
| 逆变器效率（%） | DECIMAL | 5,2 | NOT NULL | 0-100%，低于85%标记为"设备异常" |
| 汇流箱组串电压（V） | DECIMAL | 8,2 | - | 允许空 |
| 组串电流（A） | DECIMAL | 8,2 | - | 允许空 |

#### 2.2.3 光伏预测数据表（光伏预测数据表）

| 属性名称 | 数据类型 | 长度 | 约束条件 | 说明 |
|---------|---------|------|---------|------|
| 预测编号 | VARCHAR | 20 | PRIMARY KEY, NOT NULL, UNIQUE | 唯一标识预测记录 |
| 并网点编号 | VARCHAR | 20 | NOT NULL | 关联并网点 |
| 预测日期 | DATE | - | NOT NULL | 格式：YYYY-MM-DD |
| 预测时段 | VARCHAR | 20 | NOT NULL | 如"08:00-09:00" |
| 预测发电量（kWh） | DECIMAL | 12,2 | NOT NULL | ≥0 |
| 实际发电量（kWh） | DECIMAL | 12,2 | - | 允许空，实际数据采集后更新 |
| 偏差率（%） | DECIMAL | 5,2 | - | 允许空，超15%触发"预测模型优化提醒" |
| 预测模型版本 | VARCHAR | 20 | - | 允许空 |

### 2.3 综合能耗管理业务线

#### 2.3.1 能耗计量设备信息表（能耗计量设备信息表）

| 属性名称 | 数据类型 | 长度 | 约束条件 | 说明 |
|---------|---------|------|---------|------|
| 设备编号 | VARCHAR | 20 | PRIMARY KEY, NOT NULL, UNIQUE | 唯一标识计量设备 |
| 能源类型 | VARCHAR | 10 | NOT NULL | "水"、"蒸汽"、"天然气" |
| 安装位置 | VARCHAR | 50 | NOT NULL | 如"VOCS下面"、"糕饼一厂东北角" |
| 管径规格 | VARCHAR | 10 | - | 允许空，如"DN25"、"DN50"、"DN100" |
| 通讯协议 | VARCHAR | 10 | NOT NULL | "RS485"、"Lora" |
| 运行状态 | VARCHAR | 10 | NOT NULL | "正常"、"故障" |
| 校准周期 | INT | - | NOT NULL | 单位：月，≥3且≤24 |
| 生产厂家 | VARCHAR | 30 | - | 允许空 |

#### 2.3.2 能耗监测数据表（能耗监测数据表）

| 属性名称 | 数据类型 | 长度 | 约束条件 | 说明 |
|---------|---------|------|---------|------|
| 数据编号 | VARCHAR | 20 | PRIMARY KEY, NOT NULL, UNIQUE | 唯一标识单条监测数据 |
| 设备编号 | VARCHAR | 20 | FOREIGN KEY, NOT NULL | 关联能耗计量设备信息表 |
| 采集时间 | DATETIME | - | NOT NULL | 格式：YYYY-MM-DD HH:MM:SS |
| 能耗值 | DECIMAL | 10,2 | NOT NULL, CHECK(>=0) | 水：m³；蒸汽：t；天然气：m³ |
| 单位 | VARCHAR | 5 | NOT NULL | "m³"、"t" |
| 数据质量 | VARCHAR | 5 | NOT NULL | "优"、"良"、"中"、"差" |
| 所属厂区编号 | VARCHAR | 10 | NOT NULL | 如"真旺厂"、"豆果厂"、"A3厂区" |

#### 2.3.3 峰谷能耗数据表（峰谷能耗数据表）

| 属性名称 | 数据类型 | 长度 | 约束条件 | 说明 |
|---------|---------|------|---------|------|
| 记录编号 | VARCHAR | 20 | PRIMARY KEY, NOT NULL, UNIQUE | 唯一标识记录 |
| 能源类型 | VARCHAR | 10 | NOT NULL | "电"、"水"、"蒸汽"、"天然气" |
| 厂区编号 | VARCHAR | 10 | NOT NULL | 关联具体厂区 |
| 统计日期 | DATE | - | NOT NULL | 格式：YYYY-MM-DD |
| 尖峰时段能耗 | DECIMAL | 12,2 | NOT NULL | 10:00-12:00/16:00-18:00 |
| 高峰时段能耗 | DECIMAL | 12,2 | NOT NULL | 8:00-10:00/12:00-16:00/18:00-22:00 |
| 平段能耗 | DECIMAL | 12,2 | NOT NULL | 6:00-8:00/22:00-24:00 |
| 低谷时段能耗 | DECIMAL | 12,2 | NOT NULL | 00:00-6:00 |
| 总能耗 | DECIMAL | 12,2 | NOT NULL | 各时段能耗之和 |
| 峰谷电价 | DECIMAL | 8,4 | NOT NULL | 单位：元/kWh或元/m³或元/t |
| 能耗成本 | DECIMAL | 12,2 | NOT NULL | 单位：元 |

### 2.4 告警运维管理业务线

#### 2.4.1 告警信息表（告警信息表）

| 属性名称 | 数据类型 | 长度 | 约束条件 | 说明 |
|---------|---------|------|---------|------|
| 告警编号 | VARCHAR | 20 | PRIMARY KEY, NOT NULL, UNIQUE | 唯一标识告警 |
| 告警类型 | VARCHAR | 20 | NOT NULL | "越限告警"、"通讯故障"、"设备故障" |
| 关联设备编号 | VARCHAR | 20 | NOT NULL | 如变压器编号/光伏逆变器编号 |
| 发生时间 | DATETIME | - | NOT NULL | 格式：YYYY-MM-DD HH:MM:SS |
| 告警等级 | VARCHAR | 20 | NOT NULL | "高"、"中"、"低" |
| 告警内容 | VARCHAR | 500 | NOT NULL | 如"35KV主变绕组温度超100℃" |
| 处理状态 | VARCHAR | 20 | NOT NULL, DEFAULT '未处理' | "未处理"、"处理中"、"已结案" |
| 告警触发阈值 | VARCHAR | 100 | - | 允许空 |

#### 2.4.2 运维工单数据表（运维工单数据表）

| 属性名称 | 数据类型 | 长度 | 约束条件 | 说明 |
|---------|---------|------|---------|------|
| 工单编号 | VARCHAR | 20 | PRIMARY KEY, NOT NULL, UNIQUE | 唯一标识工单 |
| 告警编号 | VARCHAR | 20 | FOREIGN KEY, NOT NULL | 关联告警信息表 |
| 运维人员ID | VARCHAR | 20 | NOT NULL | 关联人员管理系统ID |
| 派单时间 | DATETIME | - | NOT NULL | 格式：YYYY-MM-DD HH:MM:SS |
| 响应时间 | DATETIME | - | - | 允许空 |
| 处理完成时间 | DATETIME | - | - | 允许空 |
| 处理结果 | VARCHAR | 500 | - | 允许空，如"更换电缆头温度传感器" |
| 复查状态 | VARCHAR | 10 | - | "通过"、"未通过" |
| 附件路径 | VARCHAR | 200 | - | 允许空，如故障现场照片路径 |

#### 2.4.3 设备台账数据表（设备台账数据表）

| 属性名称 | 数据类型 | 长度 | 约束条件 | 说明 |
|---------|---------|------|---------|------|
| 台账编号 | VARCHAR | 20 | PRIMARY KEY, NOT NULL, UNIQUE | 唯一标识台账 |
| 设备名称 | VARCHAR | 50 | NOT NULL | 设备名称 |
| 设备类型 | VARCHAR | 10 | NOT NULL | "变压器"、"水表"、"逆变器" |
| 型号规格 | VARCHAR | 50 | - | 允许空 |
| 安装时间 | DATETIME | - | NOT NULL | 格式：YYYY-MM-DD HH:MM:SS |
| 质保期（年） | INT | - | - | 允许空，质保期到期前30天触发提醒 |
| 维修记录 | VARCHAR | 20 | - | 允许空，关联工单编号 |
| 校准记录 | VARCHAR | 20 | - | 允许空，校准时间/校准人员 |
| 报废状态 | VARCHAR | 10 | - | "正常使用"、"已报废" |

### 2.5 大屏数据展示业务线

#### 2.5.1 大屏展示配置表（大屏展示配置表）

| 属性名称 | 数据类型 | 长度 | 约束条件 | 说明 |
|---------|---------|------|---------|------|
| 配置编号 | VARCHAR | 20 | PRIMARY KEY, NOT NULL, UNIQUE | 唯一标识配置 |
| 展示模块 | VARCHAR | 50 | NOT NULL | "能源总览"、"光伏总览"、"配电网运行状态"、"告警统计" |
| 数据刷新频率 | VARCHAR | 20 | NOT NULL | "秒"、"分钟" |
| 展示字段 | VARCHAR | 500 | - | 允许空，如"总能耗/光伏发电量/高等级告警数" |
| 排序规则 | VARCHAR | 50 | - | 允许空，"按时间降序"、"按能耗降序" |
| 权限等级 | VARCHAR | 20 | NOT NULL | "管理员"、"能源管理员"、"运维人员" |

#### 2.5.2 实时汇总数据表（实时汇总数据表）

| 属性名称 | 数据类型 | 长度 | 约束条件 | 说明 |
|---------|---------|------|---------|------|
| 汇总编号 | VARCHAR | 15 | PRIMARY KEY, NOT NULL, UNIQUE | 如"001"、"002" |
| 统计时间 | DATETIME | - | NOT NULL | 格式：YYYY-MM-DD HH:MM:SS |
| 总用电量（kWh） | DECIMAL | 18,2 | - | 允许空 |
| 总用水量（m³） | DECIMAL | 18,2 | - | 允许空 |
| 总蒸汽消耗量（t） | DECIMAL | 18,2 | - | 允许空 |
| 总天然气消耗量（m³） | DECIMAL | 18,2 | - | 允许空 |
| 光伏总发电量（kWh） | DECIMAL | 18,2 | - | 允许空 |
| 光伏自用电量（kWh） | DECIMAL | 18,2 | - | 允许空 |
| 总告警次数 | INT | - | - | 允许空 |
| 高等级告警数 | INT | - | - | 允许空 |
| 中等级告警数 | INT | - | - | 允许空 |
| 低等级告警数 | INT | - | 允许空 |

#### 2.5.3 历史趋势数据表（历史趋势数据表）

| 属性名称 | 数据类型 | 长度 | 约束条件 | 说明 |
|---------|---------|------|---------|------|
| 趋势编号 | VARCHAR | 20 | PRIMARY KEY, NOT NULL, UNIQUE | 唯一标识趋势记录 |
| 能源类型 | VARCHAR | 10 | NOT NULL | "电"、"水"、"蒸汽"、"天然气"、"光伏" |
| 统计周期 | VARCHAR | 10 | NOT NULL | "日"、"周"、"月" |
| 统计时间 | DATE | - | NOT NULL | 格式：YYYY-MM-DD |
| 能耗/发电量数值 | DECIMAL | 18,2 | NOT NULL | ≥0 |
| 同比增长率（%） | DECIMAL | 6,2 | - | 允许空 |
| 环比增长率（%） | DECIMAL | 6,2 | - | 允许空 |
| 行业均值 | DECIMAL | 18,2 | - | 允许空 |

### 2.6 用户管理

#### 2.6.1 用户表（用户表）

| 属性名称 | 数据类型 | 长度 | 约束条件 | 说明 |
|---------|---------|------|---------|------|
| 用户ID | CHAR | 3 | PRIMARY KEY, NOT NULL, UNIQUE | 唯一标识用户，如"001"、"002" |
| 姓名 | VARCHAR | 50 | NOT NULL | 用户真实姓名 |
| 密码 | VARCHAR | 100 | NOT NULL | 哈希后的密码字符串（MD5或SHA-256） |
| 角色 | VARCHAR | 50 | NOT NULL | "系统管理员"、"能源管理员"、"运维人员"、"数据分析师"、"企业管理层"、"运维工单管理员" |

## 三、概念结构设计（E-R图）

### 3.1 实体关系说明

#### 3.1.1 配电网监测业务线实体关系

- **配电房信息表**（1）---<（N）**回路监测数据表**：一个配电房可以有多个回路监测数据
- **配电房信息表**（1）---<（N）**变压器监测数据表**：一个配电房可以有多个变压器监测数据

#### 3.1.2 分布式光伏管理业务线实体关系

- **光伏设备信息表**（1）---<（N）**光伏发电数据表**：一个光伏设备可以产生多条发电数据
- **光伏预测数据表**：独立实体，通过并网点编号关联

#### 3.1.3 综合能耗管理业务线实体关系

- **能耗计量设备信息表**（1）---<（N）**能耗监测数据表**：一个计量设备可以产生多条监测数据
- **峰谷能耗数据表**：独立实体，按厂区编号和能源类型统计

#### 3.1.4 告警运维管理业务线实体关系

- **告警信息表**（1）---<（1）**运维工单数据表**：一个告警对应一个运维工单（一对一关系）
- **设备台账数据表**：独立实体，通过设备编号关联告警和工单

#### 3.1.5 大屏数据展示业务线实体关系

- **大屏展示配置表**：独立实体
- **实时汇总数据表**：独立实体，按时间汇总
- **历史趋势数据表**：独立实体，按能源类型和统计周期分类

### 3.2 全局E-R图关键关系

1. **配电房信息表** ← **回路监测数据表**、**变压器监测数据表**
2. **光伏设备信息表** ← **光伏发电数据表**
3. **能耗计量设备信息表** ← **能耗监测数据表**
4. **告警信息表** → **运维工单数据表**
5. **用户表** → **告警信息表**（负责人）、**运维工单数据表**（运维人员）

## 四、逻辑结构设计

### 4.1 关系模式

所有表均满足第三范式（3NF），消除了传递依赖和数据冗余：

1. **配电房信息表**（配电房编号，名称，位置描述，电压等级，变压器数量，投运时间，负责人ID，联系方式）
   - 主键：配电房编号
   - 无传递依赖

2. **回路监测数据表**（数据编号，配电房编号，回路编号，采集时间，电压，电流，有功功率，无功功率，功率因数，正向有功电量，反向有功电量，开关状态，电缆头温度，电容器温度）
   - 主键：数据编号
   - 外键：配电房编号 → 配电房信息表.配电房编号

3. **变压器监测数据表**（数据编号，配电房编号，变压器编号，采集时间，负载率，绕组温度，铁芯温度，环境温度，环境湿度，运行状态）
   - 主键：数据编号
   - 外键：配电房编号 → 配电房信息表.配电房编号

4. **光伏设备信息表**（设备编号，设备类型，安装位置，装机容量，投运时间，校准周期，运行状态，通信协议）
   - 主键：设备编号

5. **光伏发电数据表**（数据编号，设备编号，并网点编号，采集时间，发电量，上网电量，自用电量，逆变器效率，汇流箱组串电压，组串电流）
   - 主键：数据编号
   - 外键：设备编号 → 光伏设备信息表.设备编号

6. **光伏预测数据表**（预测编号，并网点编号，预测日期，预测时段，预测发电量，实际发电量，偏差率，预测模型版本）
   - 主键：预测编号

7. **能耗计量设备信息表**（设备编号，能源类型，安装位置，管径规格，通讯协议，运行状态，校准周期，生产厂家）
   - 主键：设备编号

8. **能耗监测数据表**（数据编号，设备编号，采集时间，能耗值，单位，数据质量，所属厂区编号）
   - 主键：数据编号
   - 外键：设备编号 → 能耗计量设备信息表.设备编号

9. **峰谷能耗数据表**（记录编号，能源类型，厂区编号，统计日期，尖峰时段能耗，高峰时段能耗，平段能耗，低谷时段能耗，总能耗，峰谷电价，能耗成本）
   - 主键：记录编号

10. **告警信息表**（告警编号，告警类型，关联设备编号，发生时间，告警等级，告警内容，处理状态，告警触发阈值）
    - 主键：告警编号

11. **运维工单数据表**（工单编号，告警编号，运维人员ID，派单时间，响应时间，处理完成时间，处理结果，复查状态，附件路径）
    - 主键：工单编号
    - 外键：告警编号 → 告警信息表.告警编号

12. **设备台账数据表**（台账编号，设备名称，设备类型，型号规格，安装时间，质保期，维修记录，校准记录，报废状态）
    - 主键：台账编号

13. **大屏展示配置表**（配置编号，展示模块，数据刷新频率，展示字段，排序规则，权限等级）
    - 主键：配置编号

14. **实时汇总数据表**（汇总编号，统计时间，总用电量，总用水量，总蒸汽消耗量，总天然气消耗量，光伏总发电量，光伏自用电量，总告警次数，高等级告警数，中等级告警数，低等级告警数）
    - 主键：汇总编号

15. **历史趋势数据表**（趋势编号，能源类型，统计周期，统计时间，能耗/发电量数值，同比增长率，环比增长率，行业均值）
    - 主键：趋势编号

16. **用户表**（用户ID，姓名，密码，角色）
    - 主键：用户ID

### 4.2 范式验证

所有关系模式均满足第三范式：
- 每个非主属性完全依赖于主键
- 不存在传递依赖
- 消除了数据冗余

## 五、物理结构设计

### 5.1 索引设计

为提高查询效率，针对高频查询字段设计索引：

1. **配电房信息表**
   - PRIMARY KEY: 配电房编号
   - INDEX: 负责人ID（用于查询负责人管理的配电房）

2. **回路监测数据表**
   - PRIMARY KEY: 数据编号
   - INDEX: 配电房编号（用于按配电房查询）
   - INDEX: 采集时间（用于时间范围查询）
   - INDEX: (配电房编号, 采集时间)（复合索引，用于按配电房和时间查询）

3. **变压器监测数据表**
   - PRIMARY KEY: 数据编号
   - INDEX: 配电房编号（用于按配电房查询）
   - INDEX: 采集时间（用于时间范围查询）
   - INDEX: 运行状态（用于查询异常数据）

4. **光伏设备信息表**
   - PRIMARY KEY: 设备编号
   - INDEX: 运行状态（用于查询故障/离线设备）

5. **光伏发电数据表**
   - PRIMARY KEY: 数据编号
   - INDEX: 设备编号（用于按设备查询）
   - INDEX: 采集时间（用于时间范围查询）

6. **能耗监测数据表**
   - PRIMARY KEY: 数据编号
   - INDEX: 设备编号（用于按设备查询）
   - INDEX: 所属厂区编号（用于按厂区查询）
   - INDEX: 采集时间（用于时间范围查询）

7. **告警信息表**
   - PRIMARY KEY: 告警编号
   - INDEX: 关联设备编号（用于按设备查询告警）
   - INDEX: 告警等级（用于查询高等级告警）
   - INDEX: 处理状态（用于查询未处理告警）
   - INDEX: 发生时间（用于时间范围查询）

8. **运维工单数据表**
   - PRIMARY KEY: 工单编号
   - INDEX: 告警编号（用于按告警查询工单）
   - INDEX: 运维人员ID（用于查询人员工作量）

9. **峰谷能耗数据表**
   - PRIMARY KEY: 记录编号
   - INDEX: 厂区编号（用于按厂区查询）
   - INDEX: 统计日期（用于时间范围查询）
   - INDEX: (厂区编号, 统计日期)（复合索引）

10. **实时汇总数据表**
    - PRIMARY KEY: 汇总编号
    - INDEX: 统计时间（用于查询最新数据）

11. **历史趋势数据表**
    - PRIMARY KEY: 趋势编号
    - INDEX: 能源类型（用于按能源类型查询）
    - INDEX: 统计周期（用于按周期查询）
    - INDEX: (能源类型, 统计周期, 统计时间)（复合索引）

### 5.2 约束条件设计

1. **主键约束**：所有表均设置主键，确保唯一性
2. **外键约束**：设置外键关联，确保数据完整性
3. **非空约束**：关键字段设置NOT NULL
4. **检查约束**：
   - 变压器数量 >= 1
   - 能耗值 >= 0
   - 校准周期 >= 3 且 <= 24
   - 功率因数 0.85-1.00
5. **默认值约束**：告警信息表.处理状态默认值为"未处理"

### 5.3 数据类型选择

- **VARCHAR**：用于变长字符串，根据实际需求设置长度
- **CHAR**：用于定长字符串，如用户ID
- **DECIMAL**：用于精确数值，如金额、电量等
- **INT/TINYINT**：用于整数，根据数值范围选择
- **DATETIME/DATE**：用于日期时间
- **TEXT**：用于长文本（如告警内容）

## 六、总结

本数据库设计文档完成了SmartEnergy智慧能源管理系统的数据库结构设计工作，包括：

1. ✅ **需求分析**：明确了5条核心业务线的数据需求
2. ✅ **数据字典**：详细定义了16个数据表的所有属性、数据类型、约束条件
3. ✅ **概念结构设计**：明确了实体间的一对一、一对多关系
4. ✅ **逻辑结构设计**：将概念结构转化为关系模式，满足第三范式
5. ✅ **物理结构设计**：设计了索引、约束条件，优化查询性能

所有设计均符合任务书要求，为后续的数据库实施、测试和持久层设计奠定了基础。

