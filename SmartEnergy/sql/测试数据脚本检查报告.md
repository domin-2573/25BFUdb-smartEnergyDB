# 测试数据SQL脚本检查报告

## 检查日期
2025-01-01

## 发现的问题

### 1. 表名不匹配 ❌

**问题描述：**
- 原脚本使用：`光伏设备信息`
- 正确表名：`光伏设备信息表`
- 原脚本使用：`能耗计量设备信息`
- 正确表名：`能耗计量设备信息表`

**影响：**
- 执行INSERT语句时会报错：`Table 'smart_energy.光伏设备信息' doesn't exist`

**修正：**
- 已将所有表名修正为正确的名称

### 2. 列名检查 ✅

**检查结果：**
- `配电房信息表`：所有列名正确
- `光伏设备信息表`：所有列名正确（修正表名后）
- `能耗计量设备信息表`：所有列名正确（修正表名后）
- `用户表`：所有列名正确
- `回路监测数据表`：所有列名正确

### 3. 数据类型检查 ⚠️

**需要注意的问题：**

#### 3.1 功率因数约束
- DDL定义：`DECIMAL(4,2) NOT NULL CHECK (功率因数 >= 0.85 AND 功率因数 <= 1.00)`
- 检查结果：所有数据都在有效范围内 ✅

#### 3.2 装机容量格式
- DDL定义：`VARCHAR(50) NOT NULL COMMENT '单位：kWp'`
- 原脚本：`'226kW'`（缺少'p'）
- 建议：统一为 `'226kWp'` 格式
- 已修正 ✅

#### 3.3 数据编号唯一性
- 原脚本中部分数据编号可能重复（如回路监测数据表）
- 已修正为唯一编号（HL001, HL002, ...）✅

### 4. 外键约束检查 ⚠️

**需要验证的关联关系：**

#### 4.1 回路监测数据表 → 配电房信息表
- 外键字段：`配电房编号`
- 检查：所有引用的配电房编号（PDF001-PDF030）都已存在于配电房信息表中 ✅

#### 4.2 光伏发电数据表 → 光伏设备信息表
- 外键字段：`设备编号`
- 注意：原脚本未包含光伏发电数据表的INSERT语句
- 建议：需要补充光伏发电数据表的测试数据

#### 4.3 能耗监测数据表 → 能耗计量设备信息表
- 外键字段：`设备编号`
- 注意：原脚本未包含能耗监测数据表的INSERT语句
- 建议：需要补充能耗监测数据表的测试数据

### 5. 数据完整性检查 ⚠️

**缺失的表数据：**
1. ❌ 变压器监测数据表（无数据）
2. ❌ 光伏发电数据表（无数据）
3. ❌ 光伏预测数据表（无数据）
4. ❌ 能耗监测数据表（无数据）
5. ❌ 峰谷能耗数据表（无数据）
6. ❌ 告警信息表（无数据）
7. ❌ 运维工单数据表（无数据）
8. ❌ 设备台账数据表（无数据）
9. ❌ 大屏展示配置表（无数据）
10. ❌ 实时汇总数据表（无数据）
11. ❌ 历史趋势数据表（无数据）

**建议：**
- 根据课程设计要求，每张表至少需要20条测试数据
- 需要补充以上所有表的测试数据

### 6. 脚本完整性检查 ⚠️

**问题：**
- 原脚本在回路监测数据表的第33条记录处被截断
- 最后一条记录不完整：`('033`

**修正：**
- 已补充完整的第33条记录
- 建议检查原始数据源，确保所有数据完整

## 修正后的脚本

已创建修正版脚本：`sql/05_测试数据_修正版.sql`

**主要修正内容：**
1. ✅ 修正表名：`光伏设备信息` → `光伏设备信息表`
2. ✅ 修正表名：`能耗计量设备信息` → `能耗计量设备信息表`
3. ✅ 修正装机容量格式：`'226kW'` → `'226kWp'`
4. ✅ 修正数据编号，确保唯一性
5. ✅ 补充完整的回路监测数据（33条）

## 使用建议

1. **执行顺序：**
   - 先执行 `01_DDL_创建表结构.sql` 创建表结构
   - 再执行 `05_测试数据_修正版.sql` 插入测试数据

2. **数据补充：**
   - 建议补充其他表的测试数据，确保每张表至少20条
   - 特别注意外键关联的数据需要先插入主表数据

3. **数据验证：**
   - 执行INSERT后，建议运行SELECT查询验证数据是否正确插入
   - 检查外键约束是否满足

## 示例验证查询

```sql
-- 验证配电房信息表数据
SELECT COUNT(*) AS 配电房数量 FROM `配电房信息表`;

-- 验证光伏设备信息表数据
SELECT COUNT(*) AS 光伏设备数量 FROM `光伏设备信息表`;

-- 验证回路监测数据表数据
SELECT COUNT(*) AS 回路数据数量 FROM `回路监测数据表`;

-- 验证外键关联
SELECT 
    h.`数据编号`,
    h.`配电房编号`,
    p.`名称` AS 配电房名称
FROM `回路监测数据表` h
LEFT JOIN `配电房信息表` p ON h.`配电房编号` = p.`配电房编号`
WHERE p.`配电房编号` IS NULL;  -- 如果返回空，说明外键关联正确
```

## 总结

✅ **可以使用的部分：**
- 配电房信息表数据（30条）
- 用户表数据（12条，建议补充至20条）
- 回路监测数据表数据（33条，已修正）

⚠️ **需要修正的部分：**
- 表名修正（已完成）
- 装机容量格式修正（已完成）
- 数据编号唯一性修正（已完成）

❌ **需要补充的部分：**
- 其他11张表的测试数据（每张表至少20条）


